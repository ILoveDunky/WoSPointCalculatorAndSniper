<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiteout Survival - Event Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --accent-blue: #0f4c75;
            --bright-blue: #3282b8;
            --text-primary: #ffffff;
            --text-secondary: #b8c5d6;
            --border-color: #2a3f5f;
            --success: #4caf50;
            --warning: #ff9800;
            --gradient: linear-gradient(135deg, #0f4c75, #3282b8);
            --gold: #ffd700;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--gradient);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(15, 76, 117, 0.3);
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .donation-note {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--gold);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .donation-note .gold-text {
            color: var(--gold);
            font-weight: bold;
        }

        .event-selector {
            margin-bottom: 30px;
        }

        .event-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .event-tab {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .event-tab:hover {
            border-color: var(--bright-blue);
            color: var(--text-primary);
        }

        .event-tab.active {
            background: var(--gradient);
            border-color: var(--bright-blue);
            color: var(--text-primary);
            box-shadow: 0 4px 15px rgba(50, 130, 184, 0.3);
        }

        .calculator-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--bright-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .toggle.active {
            background: var(--bright-blue);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle.active::after {
            transform: translateX(24px);
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .item-card:hover {
            border-color: var(--bright-blue);
            box-shadow: 0 4px 15px rgba(50, 130, 184, 0.2);
        }

        .item-card.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .item-points {
            color: var(--bright-blue);
            font-weight: bold;
            font-size: 0.9rem;
        }

        .item-input {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 1rem;
        }

        .item-input:focus {
            outline: none;
            border-color: var(--bright-blue);
            box-shadow: 0 0 0 2px rgba(50, 130, 184, 0.2);
        }

        .troop-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .troop-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .summary {
            background: var(--gradient);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(15, 76, 117, 0.3);
        }

        .total-points {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .sniping-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .sniping-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .sniping-result {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--bright-blue);
        }

        .custom-event-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .custom-items-list {
            margin-top: 15px;
        }

        .custom-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
        }

        .efficiency-badge {
            background: var(--success);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .efficiency-badge.medium {
            background: var(--warning);
        }

        .efficiency-badge.low {
            background: #f44336;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .add-custom-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .event-tabs {
                flex-direction: column;
            }
            
            .items-grid {
                grid-template-columns: 1fr;
            }
            
            .total-points {
                font-size: 2rem;
            }
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            border: 1px solid var(--border-color);
            z-index: 100;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        .special-inputs {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }

        .special-inputs h4 {
            color: var(--bright-blue);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>⚔️ Whiteout Survival Event Calculator</h1>
            <p>Optimize your resources and dominate the events</p>
            <div class="donation-note">
                <p>🎯 This tool is completely free! If it helps you dominate events, feel free to <span class="gold-text">Donate Froststars</span> in-game!</p>
                <p><span class="gold-text">Player ID: 176435188</span> 🎁</p>
            </div>
        </header>

        <div class="event-selector">
            <div class="event-tabs">
                <div class="event-tab active" data-event="koi">🧊 King of Icefield</div>
                <div class="event-tab" data-event="officer-essence">🧑‍✈️ Officer - Essence</div>
                <div class="event-tab" data-event="officer-charm">🧑‍✈️ Officer - Charm</div>
                <div class="event-tab" data-event="armament-tomes">🏹 Armament - Tomes</div>
                <div class="event-tab" data-event="armament-design">🏹 Armament - Design</div>
                <div class="event-tab" data-event="svs">🏴‍☠️ State vs State</div>
                <div class="event-tab" data-event="custom">⚙️ Custom Event</div>
            </div>
        </div>

        <div class="calculator-section">
            <h2 class="section-title" id="section-title">🧊 King of Icefield Calculator</h2>
            
            <div class="toggle-container">
                <div class="toggle" id="sniping-toggle"></div>
                <label>Enable Sniping Calculator</label>
                
                <div class="toggle" id="troops-toggle" style="margin-left: 20px;"></div>
                <label>Enable Troop Training</label>
            </div>

            <div id="toggles-container"></div>

            <div id="custom-event-creator" class="custom-event-section" style="display: none;">
                <h3>Create Custom Event</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <input type="text" id="custom-event-name" placeholder="Event Name" class="item-input" style="flex: 1; min-width: 200px;">
                    <input type="text" id="custom-item-name" placeholder="Item Name" class="item-input" style="flex: 1; min-width: 150px;">
                    <input type="number" id="custom-item-points" placeholder="Points" class="item-input" style="width: 100px;">
                    <button class="add-custom-btn" onclick="addCustomItem()">Add Item</button>
                </div>
                <div class="custom-items-list" id="custom-items-list"></div>
                <button class="add-custom-btn" onclick="saveCustomEvent()" style="background: var(--bright-blue);">Save Event</button>
            </div>

            <div class="items-grid" id="items-container"></div>

            <div class="troop-section" id="troop-section" style="display: none;">
                <h3 class="section-title">🪖 Troop Training Calculator</h3>
                <div class="troop-inputs">
                    <div class="input-group">
                        <label class="input-label">Highest Troop Level</label>
                        <select class="item-input" id="troop-level">
                            <option value="">Select Level</option>
                            <option value="1">Level 1</option>
                            <option value="2">Level 2</option>
                            <option value="3">Level 3</option>
                            <option value="4">Level 4</option>
                            <option value="5">Level 5</option>
                            <option value="6">Level 6</option>
                            <option value="7">Level 7</option>
                            <option value="8">Level 8</option>
                            <option value="9">Level 9</option>
                            <option value="10">Level 10</option>
                            <option value="11">Level 11</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Time per Troop (minutes)</label>
                        <input type="number" class="item-input" id="troop-time" placeholder="e.g. 30">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Available Speedups (minutes)</label>
                        <input type="number" class="item-input" id="troop-speedups" placeholder="Total minutes">
                    </div>
                </div>
                <div id="troop-calculation" style="margin-top: 15px;"></div>
            </div>

            <div id="special-calculations"></div>

            <div class="sniping-section" id="sniping-section" style="display: none;">
                <h3 class="section-title">🎯 Sniping Calculator</h3>
                <div class="sniping-inputs">
                    <div class="input-group">
                        <label class="input-label">Target Point Gap</label>
                        <input type="number" class="item-input" id="target-gap" placeholder="Enter points needed">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Min General Shards per Use</label>
                        <select class="item-input" id="min-shards">
                            <option value="1">Any Amount</option>
                            <option value="5">5 minimum</option>
                            <option value="10">10 minimum</option>
                            <option value="40">40 minimum</option>
                            <option value="100">100 minimum</option>
                        </select>
                    </div>
                </div>
                <div class="sniping-result" id="sniping-result"></div>
            </div>
        </div>

        <div class="summary">
            <div class="total-points" id="total-points">0</div>
            <p>Total Event Points</p>
        </div>
    </div>

    <script>
        // Event data structure
        const eventData = {
            'koi': {
                title: "🧊 King of Icefield Calculator",
                items: {
                    'Fire Crystals': { points: 2000, available: true, toggle: 'fire-crystals' },
                    'Fire Crystal Shards': { points: 1000, available: true, toggle: 'fire-shards' },
                    '1 Minute of Speedups': { points: 30, available: true, toggle: 'speedups' },
                    'Mythic General Shards': { points: 3040, available: true, toggle: 'mythic-shards', minAmount: 5 },
                    'Hero Gear Essence Stones': { points: 4000, available: true, toggle: 'essence-stones' },
                    'Mithril': { points: 40000, available: true, toggle: 'mithril' },
                    'Advanced Wild Marks': { points: 15000, available: true, toggle: 'adv-marks' },
                    'Common Wild Marks': { points: 1150, available: true, toggle: 'common-marks' },
                    'Epic Hero Shards': { points: 1220, available: true, toggle: 'epic-shards', minAmount: 5 }
                },
                troops: {
                    1: 1, 2: 2, 3: 3, 4: 5, 5: 7, 6: 11, 7: 16, 8: 23, 9: 30, 10: 39, 11: 49
                },
                toggles: []
            },
            'officer-essence': {
                title: "🧑‍✈️ Officer Project - Essence Stone",
                items: {
                    'Hero Gear Essence Stone': { points: 6000, available: true, toggle: 'essence-stones' },
                    'Mithril': { points: 216000, available: true, toggle: 'mithril' }
                },
                troops: {
                    1: 1, 2: 2, 3: 3, 4: 4, 5: 6, 6: 9, 7: 12, 8: 17, 9: 22, 10: 30, 11: 37
                },
                toggles: []
            },
            'officer-charm': {
                title: "🧑‍✈️ Officer Project - Charm Designs",
                items: {
                    'Hero Gear Essence Stone': { points: 6000, available: true, toggle: 'essence-stones' },
                    'Mythic General Shards': { points: 3040, available: true, toggle: 'mythic-shards', minAmount: 5 },
                    'Epic Hero Shards': { points: 1220, available: true, toggle: 'epic-shards', minAmount: 5 }
                },
                troops: {},
                toggles: []
            },
            'armament-tomes': {
                title: "🏹 Armament Competition - Two Tomes",
                items: {
                    'Fire Crystal': { points: 100, available: true, toggle: 'fire-crystals' },
                    'Refined Fire Crystal': { points: 1500, available: false, toggle: 'fc6' },
                    'Fire Crystal Shard (research)': { points: 50, available: false, toggle: 'state-age' },
                    'Mithril': { points: 28800, available: true, toggle: 'mithril' },
                    'Hero Gear Essence Stone': { points: 800, available: true, toggle: 'essence-stones' },
                    '1 Minute of Speedups': { points: 1, available: true, toggle: 'speedups' }
                },
                troops: {},
                toggles: [
                    { id: 'fc6', label: 'FC6+ Available', tooltip: 'Enable if you have Furnace Core level 6+' },
                    { id: 'state-age', label: 'State Age Research', tooltip: 'Enable if your state has research unlocked' }
                ]
            },
            'armament-design': {
                title: "🏹 Armament Competition - Design Plan",
                items: {
                    'Fire Crystal': { points: 100, available: true, toggle: 'fire-crystals' },
                    'Refined Fire Crystal': { points: 1500, available: false, toggle: 'fc6' },
                    'Fire Crystal Shard (research)': { points: 50, available: false, toggle: 'state-age' },
                    'Mithril': { points: 28800, available: true, toggle: 'mithril' },
                    'Hero Gear Essence Stone': { points: 800, available: true, toggle: 'essence-stones' },
                    '1 Minute of Speedups': { points: 1, available: true, toggle: 'speedups' }
                },
                troops: {},
                toggles: [
                    { id: 'fc6', label: 'FC6+ Available', tooltip: 'Enable if you have Furnace Core level 6+' },
                    { id: 'state-age', label: 'State Age Research', tooltip: 'Enable if your state has research unlocked' }
                ]
            },
            'svs': {
                title: "🏴‍☠️ State vs State - Prep Phase",
                items: {
                    'Fire Crystal': { points: 2000, available: true, toggle: 'fire-crystals' },
                    'Fire Crystal Shard (research)': { points: 1000, available: true, toggle: 'fire-shards' },
                    'Refined Fire Crystal': { points: 30000, available: true, toggle: 'refined-crystals' },
                    '1 Minute of Speedups': { points: 30, available: true, toggle: 'speedups' },
                    'Epic Hero Shard': { points: 1220, available: true, toggle: 'epic-shards', minAmount: 5 },
                    'Mythic General Shard': { points: 3040, available: true, toggle: 'mythic-shards', minAmount: 5 },
                    '1 Stamina (Beast Lvl 26+ / PTR)': { points: 1200, available: false, toggle: 'beast-26' },
                    'Advanced Wild Marks': { points: 15000, available: true, toggle: 'adv-marks' },
                    'Common Wild Marks': { points: 1150, available: true, toggle: 'common-marks' },
                    'Hero Gear Essence Stone': { points: 4000, available: true, toggle: 'essence-stones' },
                    'Mithril': { points: 40000, available: true, toggle: 'mithril' }
                },
                troops: {
                    1: 3, 2: 4, 3: 5, 4: 8, 5: 12, 6: 18, 7: 25, 8: 35, 9: 45, 10: 60, 11: 75
                },
                toggles: [
                    { id: 'beast-26', label: 'Beast Level 26+', tooltip: 'Enable if your beast is level 26 or higher' }
                ],
                specialCalculations: {
                    beasts: { label: 'Beasts Killed', points: 1200, stamina: 10 },
                    polarTerror: { label: 'Polar Terror Rallies', points: 30000, stamina: 25 }
                }
            },
            'custom': {
                title: "⚙️ Custom Event Calculator",
                items: {},
                troops: {},
                toggles: []
            }
        };

        // Current state
        let currentEvent = 'koi';
        let snipingEnabled = false;
        let troopsEnabled = false;
        let itemCounts = {};
        let toggleStates = {};
        let customEvents = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            setupEventHandlers();
            renderCurrentEvent();
            calculateTotal();
        });

        function setupEventHandlers() {
            // Event tab handlers
            document.querySelectorAll('.event-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const event = this.dataset.event;
                    switchEvent(event);
                });
            });

            // Sniping toggle
            document.getElementById('sniping-toggle').addEventListener('click', function() {
                snipingEnabled = !snipingEnabled;
                this.classList.toggle('active', snipingEnabled);
                document.getElementById('sniping-section').style.display = snipingEnabled ? 'block' : 'none';
                saveToStorage();
            });

            // Troops toggle
            document.getElementById('troops-toggle').addEventListener('click', function() {
                troopsEnabled = !troopsEnabled;
                this.classList.toggle('active', troopsEnabled);
                document.getElementById('troop-section').style.display = troopsEnabled ? 'block' : 'none';
                calculateTroops();
                saveToStorage();
            });

            // Target gap input
            document.getElementById('target-gap').addEventListener('input', calculateSniping);
            document.getElementById('min-shards').addEventListener('change', calculateSniping);

            // Troop calculation inputs
            ['troop-level', 'troop-time', 'troop-speedups'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateTroops);
            });
        }

        function switchEvent(event) {
            currentEvent = event;
            
            // Update active tab
            document.querySelectorAll('.event-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.event === event);
            });

            // Show custom event creator for custom events
            document.getElementById('custom-event-creator').style.display = 
                event === 'custom' ? 'block' : 'none';

            renderCurrentEvent();
            calculateTotal();
            saveToStorage();
        }

        function renderCurrentEvent() {
            const data = getCurrentEventData();
            
            // Update title
            document.getElementById('section-title').textContent = data.title;

            renderToggles();
            renderItems();
            renderSpecialCalculations();
            calculateTroops();
        }

        function getCurrentEventData() {
            if (currentEvent === 'custom' && customEvents[getCurrentCustomEventName()]) {
                return customEvents[getCurrentCustomEventName()];
            }
            return eventData[currentEvent];
        }

        function getCurrentCustomEventName() {
            return document.getElementById('custom-event-name')?.value || 'default';
        }

        function renderToggles() {
            const container = document.getElementById('toggles-container');
            container.innerHTML = '';

            const data = getCurrentEventData();
            const toggles = data.toggles || [];

            // Add item availability toggles for KOI and SVS
            if (currentEvent === 'koi' || currentEvent === 'svs') {
                Object.entries(data.items).forEach(([itemName, itemData]) => {
                    if (itemData.toggle && !itemData.toggle.includes('fc6') && !itemData.toggle.includes('state-age') && !itemData.toggle.includes('beast-26')) {
                        toggles.push({
                            id: itemData.toggle,
                            label: `${itemName} Available`,
                            tooltip: `Toggle availability of ${itemName}`
                        });
                    }
                });
            }
            
            toggles.forEach(toggle => {
                const toggleContainer = document.createElement('div');
                toggleContainer.className = 'toggle-container';
                
                const toggleEl = document.createElement('div');
                const toggleKey = currentEvent + '-' + toggle.id;
                toggleEl.className = `toggle ${toggleStates[toggleKey] !== false ? 'active' : ''}`;
                toggleEl.addEventListener('click', () => {
                    toggleStates[toggleKey] = !toggleStates[toggleKey];
                    toggleEl.classList.toggle('active', toggleStates[toggleKey]);
                    updateItemAvailability();
                    renderItems();
                    calculateTotal();
                    saveToStorage();
                });

                const label = document.createElement('label');
                label.className = 'tooltip';
                label.textContent = toggle.label;
                label.setAttribute('data-tooltip', toggle.tooltip);

                toggleContainer.appendChild(toggleEl);
                toggleContainer.appendChild(label);
                container.appendChild(toggleContainer);
            });
        }

        function updateItemAvailability() {
            const data = getCurrentEventData();
            Object.keys(data.items).forEach(itemName => {
                const item = data.items[itemName];
                if (item.toggle) {
                    const toggleKey = currentEvent + '-' + item.toggle;
                    // Default to true for most items, false for special toggles
                    if (item.toggle === 'fc6' || item.toggle === 'state-age' || item.toggle === 'beast-26') {
                        item.available = toggleStates[toggleKey] || false;
                    } else {
                        item.available = toggleStates[toggleKey] !== false;
                    }
                }
            });
        }

        function renderItems() {
            const container = document.getElementById('items-container');
            container.innerHTML = '';

            const data = getCurrentEventData();
            updateItemAvailability();

            // Sort items by efficiency (points per unit) for better UX
            const sortedItems = Object.entries(data.items).sort((a, b) => a[1].points - b[1].points);

            sortedItems.forEach(([itemName, itemData]) => {
                const card = document.createElement('div');
                card.className = `item-card ${!itemData.available ? 'disabled' : ''}`;

                const header = document.createElement('div');
                header.className = 'item-header';

                const name = document.createElement('div');
                name.className = 'item-name';
                name.textContent = itemName;

                const pointsContainer = document.createElement('div');
                pointsContainer.style.textAlign = 'right';

                const points = document.createElement('div');
                points.className = 'item-points';
                points.textContent = `${itemData.points.toLocaleString()} pts`;

                // Add efficiency badge
                const efficiency = getEfficiencyBadge(itemData.points);
                if (efficiency) {
                    const badge = document.createElement('div');
                    badge.className = `efficiency-badge ${efficiency.class}`;
                    badge.textContent = efficiency.text;
                    pointsContainer.appendChild(badge);
                }

                pointsContainer.appendChild(points);

                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'item-input';
                input.placeholder = itemData.minAmount ? `Min: ${itemData.minAmount}` : 'Enter quantity';
                input.min = itemData.minAmount || '0';
                input.step = itemData.minAmount || '1';
                const inputKey = currentEvent + '-' + itemName;
                input.value = itemCounts[inputKey] || '';
                input.disabled = !itemData.available;
                input.addEventListener('input', function() {
                    let value = parseInt(this.value) || 0;
                    if (itemData.minAmount && value > 0 && value < itemData.minAmount) {
                        value = Math.ceil(value / itemData.minAmount) * itemData.minAmount;
                        this.value = value;
                    }
                    itemCounts[inputKey] = value;
                    calculateTotal();
                    saveToStorage();
                });

                header.appendChild(name);
                header.appendChild(pointsContainer);
                card.appendChild(header);
                card.appendChild(input);
                container.appendChild(card);
            });
        }

        function getEfficiencyBadge(points) {
            if (points <= 100) return { text: 'Efficient', class: '' };
            if (points <= 1500) return { text: 'Efficient', class: '' };
            if (points <= 10000) return { text: 'Medium', class: 'medium' };
            return { text: 'Expensive', class: 'low' };
        }

        function renderSpecialCalculations() {
            const container = document.getElementById('special-calculations');
            container.innerHTML = '';

            const data = getCurrentEventData();
            if (!data.specialCalculations) return;

            const section = document.createElement('div');
            section.className = 'special-inputs';
            
            const title = document.createElement('h4');
            title.textContent = '🎯 Special Activities';
            section.appendChild(title);

            Object.entries(data.specialCalculations).forEach(([key, calc]) => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'input-group';
                inputGroup.style.marginBottom = '10px';

                const label = document.createElement('label');
                label.className = 'input-label';
                label.textContent = `${calc.label} (${calc.points.toLocaleString()} pts each, ${calc.stamina} stamina)`;

                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'item-input';
                input.placeholder = 'Quantity completed';
                input.min = '0';
                const inputKey = currentEvent + '-special-' + key;
                input.value = itemCounts[inputKey] || '';
                input.addEventListener('input', function() {
                    itemCounts[inputKey] = parseInt(this.value) || 0;
                    calculateTotal();
                    saveToStorage();
                });

                inputGroup.appendChild(label);
                inputGroup.appendChild(input);
                section.appendChild(inputGroup);
            });

            container.appendChild(section);
        }

        function calculateTroops() {
            const container = document.getElementById('troop-calculation');
            container.innerHTML = '';

            if (!troopsEnabled) return;

            const data = getCurrentEventData();
            if (Object.keys(data.troops).length === 0) return;

            const level = parseInt(document.getElementById('troop-level').value);
            const timePerTroop = parseInt(document.getElementById('troop-time').value);
            const speedups = parseInt(document.getElementById('troop-speedups').value);

            if (!level || !timePerTroop || !speedups) {
                container.innerHTML = '<p style="color: var(--text-secondary);">Fill in all troop fields to see calculations.</p>';
                return;
            }

            const pointsPerTroop = data.troops[level];
            const maxTroops = Math.floor(speedups / timePerTroop);
            const totalPoints = maxTroops * pointsPerTroop;

            container.innerHTML = `
                <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--bright-blue); margin-bottom: 10px;">📊 Troop Training Analysis</h4>
                    <p><strong>Level ${level} Troops:</strong> ${pointsPerTroop} points each</p>
                    <p><strong>Max Troops You Can Train:</strong> ${maxTroops.toLocaleString()}</p>
                    <p><strong>Total Troop Points:</strong> <span style="color: var(--success); font-weight: bold;">${totalPoints.toLocaleString()}</span></p>
                    <p><strong>Time Required:</strong> ${(maxTroops * timePerTroop).toLocaleString()} minutes</p>
                </div>
            `;

            // Add to total calculation
            const troopKey = currentEvent + '-troop-total';
            itemCounts[troopKey] = totalPoints;
            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            const data = getCurrentEventData();

            // Calculate item points
            Object.entries(data.items).forEach(([itemName, itemData]) => {
                if (itemData.available) {
                    const inputKey = currentEvent + '-' + itemName;
                    const quantity = itemCounts[inputKey] || 0;
                    total += quantity * itemData.points;
                }
            });

            // Calculate special activity points
            if (data.specialCalculations) {
                Object.entries(data.specialCalculations).forEach(([key, calc]) => {
                    const inputKey = currentEvent + '-special-' + key;
                    const quantity = itemCounts[inputKey] || 0;
                    total += quantity * calc.points;
                });
            }

            // Add troop points
            const troopKey = currentEvent + '-troop-total';
            total += itemCounts[troopKey] || 0;

            document.getElementById('total-points').textContent = total.toLocaleString();
        }

        function calculateSniping() {
            const targetGap = parseInt(document.getElementById('target-gap').value) || 0;
            const minShards = parseInt(document.getElementById('min-shards').value) || 1;
            const resultContainer = document.getElementById('sniping-result');

            if (targetGap <= 0) {
                resultContainer.innerHTML = '<p>Enter a target point gap to see recommendations.</p>';
                return;
            }

            const data = getCurrentEventData();
            const availableItems = Object.entries(data.items)
                .filter(([_, itemData]) => itemData.available)
                .sort((a, b) => a[1].points - b[1].points); // Sort by efficiency (cheapest first!)

            let remainingGap = targetGap;
            const solution = [];

            // Prioritize smaller, more efficient items first
            for (const [itemName, itemData] of availableItems) {
                if (remainingGap <= 0) break;
                
                let needed = Math.ceil(remainingGap / itemData.points);
                
                // Handle minimum amounts for shards
                if (itemData.minAmount && needed > 0) {
                    if (itemName.toLowerCase().includes('shard')) {
                        // Use the user's preferred minimum for shards
                        const userMin = Math.max(minShards, itemData.minAmount);
                        needed = Math.ceil(needed / userMin) * userMin;
                    } else {
                        needed = Math.ceil(needed / itemData.minAmount) * itemData.minAmount;
                    }
                }
                
                // Only suggest reasonable amounts
                const maxSuggestion = itemData.points > 10000 ? 5 : (itemData.points > 1000 ? 20 : 100);
                
                if (needed <= maxSuggestion) {
                    const points = needed * itemData.points;
                    solution.push({
                        item: itemName,
                        quantity: needed,
                        points: points,
                        efficiency: itemData.points,
                        note: itemData.minAmount ? `(min: ${itemData.minAmount})` : ''
                    });
                    remainingGap -= points;
                }
            }

            if (solution.length > 0) {
                let html = '<h4>💡 Most Efficient Resource Combination:</h4><ul>';
                let runningTotal = 0;
                
                solution.forEach((item, index) => {
                    runningTotal += item.points;
                    const efficiencyBadge = getEfficiencyBadge(item.efficiency);
                    html += `<li>
                        <strong>${item.quantity}x ${item.item}</strong> ${item.note} 
                        <span class="efficiency-badge ${efficiencyBadge.class}">${efficiencyBadge.text}</span>
                        = ${item.points.toLocaleString()} points
                    </li>`;
                });
                
                html += `</ul>
                    <div style="margin-top: 15px; padding: 10px; background: var(--success); color: white; border-radius: 6px;">
                        <strong>Total Points: ${runningTotal.toLocaleString()}</strong><br>
                        Target: ${targetGap.toLocaleString()}
                `;
                
                if (remainingGap < 0) {
                    html += `<br><span style="color: var(--warning);">⚠️ Exceeds target by ${Math.abs(remainingGap).toLocaleString()} points</span>`;
                } else if (remainingGap > 0) {
                    html += `<br><span style="color: var(--warning);">⚠️ Still need ${remainingGap.toLocaleString()} more points</span>`;
                }
                html += '</div>';
                
                resultContainer.innerHTML = html;
            } else {
                resultContainer.innerHTML = '<p>No suitable combination found. Try enabling more resources or lowering your target.</p>';
            }
        }

        // Custom event functions
        function addCustomItem() {
            const itemName = document.getElementById('custom-item-name').value.trim();
            const itemPoints = parseInt(document.getElementById('custom-item-points').value);
            
            if (!itemName || !itemPoints) {
                alert('Please enter both item name and points');
                return;
            }

            const eventName = getCurrentCustomEventName() || 'Custom Event';
            
            if (!customEvents[eventName]) {
                customEvents[eventName] = {
                    title: `⚙️ ${eventName}`,
                    items: {},
                    troops: {},
                    toggles: []
                };
            }

            customEvents[eventName].items[itemName] = {
                points: itemPoints,
                available: true
            };

            document.getElementById('custom-item-name').value = '';
            document.getElementById('custom-item-points').value = '';
            
            renderCustomItems();
            saveToStorage();
        }

        function renderCustomItems() {
            const container = document.getElementById('custom-items-list');
            const eventName = getCurrentCustomEventName();
            
            if (!customEvents[eventName]) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = '';
            Object.entries(customEvents[eventName].items).forEach(([itemName, itemData]) => {
                const div = document.createElement('div');
                div.className = 'custom-item';
                div.innerHTML = `
                    <span style="flex: 1;"><strong>${itemName}</strong></span>
                    <span>${itemData.points.toLocaleString()} pts</span>
                    <button class="delete-btn" onclick="deleteCustomItem('${eventName}', '${itemName}')">Delete</button>
                `;
                container.appendChild(div);
            });
        }

        function deleteCustomItem(eventName, itemName) {
            if (customEvents[eventName] && customEvents[eventName].items[itemName]) {
                delete customEvents[eventName].items[itemName];
                renderCustomItems();
                if (currentEvent === 'custom') {
                    renderItems();
                    calculateTotal();
                }
                saveToStorage();
            }
        }

        function saveCustomEvent() {
            const eventName = getCurrentCustomEventName();
            if (!eventName) {
                alert('Please enter an event name');
                return;
            }

            renderCurrentEvent();
            calculateTotal();
            alert(`Custom event "${eventName}" saved successfully!`);
        }

        function saveToStorage() {
            const state = {
                currentEvent,
                snipingEnabled,
                troopsEnabled,
                itemCounts,
                toggleStates,
                customEvents
            };
            localStorage.setItem('whiteout-calculator', JSON.stringify(state));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('whiteout-calculator');
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    currentEvent = state.currentEvent || 'koi';
                    snipingEnabled = state.snipingEnabled || false;
                    troopsEnabled = state.troopsEnabled || false;
                    itemCounts = state.itemCounts || {};
                    toggleStates = state.toggleStates || {};
                    customEvents = state.customEvents || {};

                    // Apply toggles
                    document.getElementById('sniping-toggle').classList.toggle('active', snipingEnabled);
                    document.getElementById('sniping-section').style.display = snipingEnabled ? 'block' : 'none';
                    document.getElementById('troops-toggle').classList.toggle('active', troopsEnabled);
                    document.getElementById('troop-section').style.display = troopsEnabled ? 'block' : 'none';
                } catch (e) {
                    console.log('Error loading saved data:', e);
                }
            }
        }

        // Auto-save every 10 seconds
        setInterval(saveToStorage, 10000);
    </script>
</body>
</html>
